/*
 * PgConnectionWrap.h
 *
 *  Created on: 2015年3月19日
 *      Author: liming
 */

#ifndef PGCONNECTIONWRAP_H_
#define PGCONNECTIONWRAP_H_

#include <libpq-fe.h>
#include <node/node.h>
#include <node/node_object_wrap.h>
#include <node/v8.h>
#include <node/uv.h>

#include "VsString.h"
#include "PgConnection.h"

using namespace v8;

class PgConnectionWrap: public node::ObjectWrap {
public:
	static void Init(Handle<Object> exports);
	bool build();
private:
	explicit PgConnectionWrap();
	explicit PgConnectionWrap(VsString* config);
	~PgConnectionWrap();

	static Persistent<Function> constructor;
	static void New(const FunctionCallbackInfo<Value>& args);
	static void Build(const FunctionCallbackInfo<Value>& args);
	static void BuildWork(uv_work_t* req);
	static void BuildWorkAfter(uv_work_t* req);

	//执行sql语句
	static void Execute(const FunctionCallbackInfo<Value>& args);
	static void ExecuteWork(uv_work_t* req);
	static void ExecuteWorkAfter(uv_work_t* req);

	//执行sql语句
	static void Escape(const FunctionCallbackInfo<Value>& args);

	VsString* config;
	PgConnection* conn;
};

#endif /* PGCONNECTIONWRAP_H_ */
