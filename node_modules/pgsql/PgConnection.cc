/*
 * PgConnection.cc
 *
 *  Created on: 2015年3月19日
 *      Author: liming
 */
#include <stdlib.h>

#include "PgConnection.h"

PgConnection::PgConnection(VsString* config) {
	this->config = vs_string_clone(config);
	this->conn = NULL;
	this->init();
}

PgConnection::~PgConnection() {
	vs_string_destroy(this->config);
	PQfinish(this->conn);
}

/**
 * 连接初始化
 */
void PgConnection::init() {
	this->conn = PQconnectdb(this->config->pt);
}

/**
 *检验连接是否有效
 */
bool PgConnection::availabe() {
	if(PQstatus(conn) == CONNECTION_OK)
	{
		return true;
	}
	else
	{
		return false;
	}
}

PgResult* PgConnection::execute(VsString* cmd)
{
	PGresult *res = PQexec(this->conn, cmd->pt);
	PgResult* pr = new PgResult(res);
	return pr;
}

/**
 * 获得连接的上一个错误
 */
const char* PgConnection::lastError()
{
	return PQerrorMessage(this->conn);
}

