#include <sys/time.h>
#include <stdio.h>
#include <time.h>

#include "VsString.h"

long vs_date_millisecond()
{
    struct timeval tv;
    struct timezone tz;
    gettimeofday(&tv, &tz);
    /*printf("tv_sec; %d\n", tv.tv_sec);
    printf("tv_usec; %d\n", tv.tv_usec);
    printf("tz_minuteswest; %d\n", tz.tz_minuteswest);
    printf("tz_dsttime, %d\n", tz.tz_dsttime);*/
    return tv.tv_sec*1000L + tv.tv_usec/1000;
}

VsString* vs_date_string()
{
    //为了获取秒级以上时间
    time_t curTime;
    time(&curTime);
    struct tm *p = localtime(&curTime);

    //获取毫秒级别时间
    struct timeval tv;
    struct timezone tz;
    gettimeofday(&tv, &tz);

    char time[24];
    sprintf(time, "%4d-%02d-%02d %02d:%02d:%02d.%03d", 1900 + p->tm_year, 1 + p->tm_mon,
        p->tm_mday, p->tm_hour, p->tm_min, p->tm_sec, tv.tv_usec/1000);
    VsString* str = vs_string_init(time);
    return str;
}