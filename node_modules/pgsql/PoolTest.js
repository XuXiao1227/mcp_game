var async = require('async');
var Pool = require('./Pool.js');

var config = {
    db:"host=127.0.0.1 dbname=test user=postgres",
    size:20
};

var pool;
async.waterfall([
    function(cb){   //连接数据库
        var initPool = new Pool(config, function(err, data){
            pool = initPool;
            cb(err);
        });
    },
    function(cb)
    {
        pool.execute("select * from test limit 2;", function(err, data){
            console.log(data);
            cb(err);
        });
    },
    //同步执行1000次sql
    function(cb)
    {
        var array = [];
        for(var i = 0; i < 10000; i++)
        {
            array[i] = i;
        }
        var start = new Date().getTime();
        async.each(array, function(index, callback) {
            pool.execute("select * from test limit 2;", function(err, data){
                callback(err);
            });
        }, function(err){
            var end = new Date().getTime();
            console.log("使用时间:" + (end - start) + "ms");
            cb(err);
        });
    }
], function (err, result) {
    console.log(pool);
    if(err)
    {
        console.log("the error is:");
        console.error(err);
    }
});
