VPATH = .:/usr/local/pgsql/include:/usr/local/pgsql/server

CC = g++

CPPFLAGS = -shared -fPIC -Dno_throw -I. -I/usr/local/pgsql/include -I/usr/local/pgsql/include/server

LINKFALGS = -shared -pthread -rdynamic -m64 -lpthread -L/usr/local/pgsql/lib -lpq

OUTDIR = ./build

#the module name
MODULE_NAME = Test.node

TARGET = $(OUTDIR)/$(MODULE_NAME)

objs = $(OUTDIR)/test.o $(OUTDIR)/VsDate.o $(OUTDIR)/VsUtil.o $(OUTDIR)/VsString.o \
	$(OUTDIR)/VsNodeUtil.o	\
	$(OUTDIR)/PgConnection.o $(OUTDIR)/PgResult.o  $(OUTDIR)/PgConnectionWrap.o \
	$(OUTDIR)/PgWorkData.o

all: $(OUTDIR) $(objs)
	flock $(OUTDIR)/linker.lock $(CC) $(LINKFALGS) -o $(TARGET) -Wl,-soname=$(MODULE_NAME) -Wl,--start-group $(objs) -Wl,--end-group
	
$(OUTDIR):
	-mkdir $@
	
$(objs): $(OUTDIR)/%.o: %.cc
	$(CC) -c $(CPPFLAGS) $< -o $@

#声明clean是一个伪目标
.PHONY: clean
clean:
	-rm -rf $(OUTDIR)
